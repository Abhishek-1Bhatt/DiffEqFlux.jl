<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Controlling Automatic Differentiation · DiffEqFlux.jl</title><link rel="canonical" href="https://diffeqflux.sciml.ai/stable/controlling_AD/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="DiffEqFlux.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">DiffEqFlux.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../examples/LV-ODE/">Optimization of Ordinary Differential Equations</a></li><li><a class="tocitem" href="../examples/LV-stochastic/">Optimization of Stochastic Differential Equations</a></li><li><a class="tocitem" href="../examples/LV-Flux/">Lotka-Volterra with Flux.train!</a></li><li><a class="tocitem" href="../examples/LV-delay/">Delay Differential Equations</a></li><li><a class="tocitem" href="../examples/NN-ODE/">Neural Ordinary Differential Equations with sciml_train</a></li><li><a class="tocitem" href="../examples/NeuralODE_Flux/">Neural Ordinary Differential Equations with Flux.train!</a></li><li><a class="tocitem" href="../examples/Supervised-NN-ODE-MNIST/">GPU-based Neural ODE Classifier for MNIST with Minibatching</a></li><li><a class="tocitem" href="../examples/local_minima/">Strategies to Avoid Local Minima</a></li><li><a class="tocitem" href="../examples/NN-SDE/">Neural Stochastic Differential Equations</a></li><li><a class="tocitem" href="../examples/NeuralOptimalControl/">Solving Optimal Control Problems with Universal Differential Equations</a></li><li><a class="tocitem" href="../examples/LV-Univ/">Universal Differential Equations for Neural Feedback Control</a></li><li><a class="tocitem" href="../examples/LV-NN-Stiff/">Enforcing Physical Constraints via Universal Differential-Algebraic Equations</a></li><li><a class="tocitem" href="../examples/LV-Jump/">Neural Jump Diffusions (Neural Jump SDE) and Neural Partial Differential Equations (Neural PDEs)</a></li><li><a class="tocitem" href="../examples/universaldiffeq/">Universal Ordinary, Stochastic, and Partial Diffrential Equation Examples</a></li></ul></li><li><a class="tocitem" href="../NeuralDELayers/">Neural Differential Equation Layers</a></li><li><a class="tocitem" href="../Flux/">Use with Flux Chain and train!</a></li><li><a class="tocitem" href="../FastChain/">FastChain</a></li><li><a class="tocitem" href="../GPUs/">GPUs</a></li><li><a class="tocitem" href="../Scimltrain/">sciml_train</a></li><li><a class="tocitem" href="../Benchmark/">Benchmark</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Controlling Automatic Differentiation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Controlling Automatic Differentiation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/DiffEqFlux.jl/blob/master/docs/src/controlling_AD.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Controlling-Automatic-Differentiation-1"><a class="docs-heading-anchor" href="#Controlling-Automatic-Differentiation-1">Controlling Automatic Differentiation</a><a class="docs-heading-anchor-permalink" href="#Controlling-Automatic-Differentiation-1" title="Permalink"></a></h1><p>One of the key features of DiffEqFlux.jl is the fact that it has many modes of differentiation which are available, allowing neural differential equations and universal differential equations to be fit in the manner that is most appropriate.</p><p>To use the automatic differentiation overloads, the differential equation just needs to be solved with <code>concrete_solve</code>. Thus for example,</p><pre><code class="language-julia">using DiffEqSensitivity, OrdinaryDiffEq, Zygote

function fiip(du,u,p,t)
  du[1] = dx = p[1]*u[1] - p[2]*u[1]*u[2]
  du[2] = dy = -p[3]*u[2] + p[4]*u[1]*u[2]
end
p = [1.5,1.0,3.0,1.0]; u0 = [1.0;1.0]
prob = ODEProblem(fiip,u0,(0.0,10.0),p)
sol = concrete_solve(prob,Tsit5())
loss(u0,p) = sum(concrete_solve(prob,Tsit5(),u0,p,saveat=0.1))
du0,dp = Zygote.gradient(loss,u0,p)</code></pre><p>this will compute the gradient of the loss function &quot;sum of the values of the solution to the ODE at timepoints dt=0.1&quot; using an adjoint method, where <code>du0</code> is the derivative of the loss function with respect to the initial condition and <code>dp</code> is the derivative of the loss function with respect to the parameters.</p><h2 id="Choosing-a-Differentiation-Method-1"><a class="docs-heading-anchor" href="#Choosing-a-Differentiation-Method-1">Choosing a Differentiation Method</a><a class="docs-heading-anchor-permalink" href="#Choosing-a-Differentiation-Method-1" title="Permalink"></a></h2><p>The choice of the method for calculating the gradient is made by passing the keyword argument <code>sensealg</code> to <code>concrete_solve</code>. The default choice is dependent on the type of differential equation and the choice of neural network architecture.</p><p>The full listing of differentiation methods is described in the <a href="https://docs.sciml.ai/latest/analysis/sensitivity/#Sensitivity-Algorithms-1">DifferentialEquations.jl documentation</a>. That page also has guidelines on how to make the right choice.</p></article></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 18 May 2020 04:40">Monday 18 May 2020</span>. Using Julia version 1.4.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
